;コマンドの自動選択処理

;-------------------------------------------------
;キャラARG:0が自動実行コマンドを実行可能かどうかを判定
;-------------------------------------------------
@IS_AUTOSELECT_N(ARG:0)
#FUNCTION
SIF ARG:0 != MASTER && CFLAG:(ARG:0):調教参加フラグ && !TCVAR:(ARG:0):51 && !TCVAR:(ARG:0):52 && !TCVAR:(ARG:0):53
	RETURNF 1
RETURNF 0

;-------------------------------------------------
;コマンドの自動実行の処理
;-------------------------------------------------
@COM_AUTOSELECT_N
;コマンドの実行優先度(この値に比例した確率でコマンドが選ばれる)
;0～999は主人公がターゲット、1000～1999は主人公がプレイヤー、2000～2999は主人公を放置
#DIM COM_PRIORITY, 3000

;コマンド実行優先度の計算に使う一時変数
#DIM COM_PRIORITY_SUM, 10

;カテゴリの選択優先度(この値に比例した確率でコマンドの傾向が決まる)
#DIM CATEGORY_PRIORITY, 10

;各コマンドの分類
#DIM COM_CATEGORY, 3000

;行動可能なキャラの一覧
#DIM CHARA_LIST, 8

;行動可能なキャラの数
#DIM CHARA_LIST_MAX

;主人公と挿入状態にあるキャラの数
#DIM INSERT_LIST_MAX

;選択可能なコマンドが最後の最後までなかった場合、ここに飛んでくる
$RESTARTED

VARSET CATEGORY_PRIORITY, 0
VARSET COM_PRIORITY, 0
VARSET COM_PRIORITY_SUM, 0
VARSET COM_CATEGORY, 0
VARSET LOCAL, 0
CHARA_LIST_MAX = 0

;まずは中心となるキャラをランダムに1名選ぶ(主導権基準値によって確率に差異があっても良い？)
;そのキャラの好みを考慮してまずコマンドの分類を、次に実際のコマンド番号を決定
;複数のキャラが可能なコマンドは複数のキャラで行うこともある
;基本はマゾよりサドが優先される

;1=既成事実0
;2=既成事実1
;3=既成事実2
;4=既成事実3

;各コマンドのカテゴリを設定
;既成事実0
;会話、酒を飲む、訓練、軍事、政務、警邏、遊戯、料理
COM_CATEGORY:300 = 1
COM_CATEGORY:301 = 1
COM_CATEGORY:302 = 1
COM_CATEGORY:303 = 1
COM_CATEGORY:304 = 1
COM_CATEGORY:305 = 1
COM_CATEGORY:307 = 1
COM_CATEGORY:306 = 1
COM_CATEGORY:310 = 1
COM_CATEGORY:1300 = 1
COM_CATEGORY:1301 = 1
COM_CATEGORY:1302 = 1
COM_CATEGORY:1303 = 1
COM_CATEGORY:1304 = 1
COM_CATEGORY:1305 = 1
COM_CATEGORY:1306 = 1
COM_CATEGORY:1310 = 1
;既成事実Lv1
;猥談、スキンシップ、頭を撫でる、髪を梳く、櫛で梳かす、甘い言葉、見つめあう、食事、水浴び、泳ぐ、花冠、狩り、出掛ける、移動、帰る
COM_CATEGORY:309 = 2
COM_CATEGORY:320 = 2
COM_CATEGORY:321 = 2
COM_CATEGORY:322 = 2
COM_CATEGORY:323 = 2
COM_CATEGORY:324 = 2
COM_CATEGORY:325 = 2
COM_CATEGORY:351 = 5
COM_CATEGORY:354 = 2
COM_CATEGORY:355 = 2
COM_CATEGORY:356 = 2
COM_CATEGORY:357 = 2
COM_CATEGORY:390 = 2
COM_CATEGORY:391 = 2
COM_CATEGORY:392 = 2
COM_CATEGORY:1307 = 2
COM_CATEGORY:1320 = 2
COM_CATEGORY:1321 = 2
COM_CATEGORY:1322 = 2
COM_CATEGORY:1323 = 2
COM_CATEGORY:1324 = 2
COM_CATEGORY:1325 = 2
COM_CATEGORY:1351 = 2
COM_CATEGORY:1354 = 2
COM_CATEGORY:1355 = 2
COM_CATEGORY:1356 = 2
COM_CATEGORY:1357 = 2
COM_CATEGORY:1390 = 2
COM_CATEGORY:1391 = 2
COM_CATEGORY:1392 = 2
;既成事実Lv2
;蜂蜜水、バードキス、ソフトキス、ディープキス、水浴び、背中を流す
COM_CATEGORY:311 = 3
COM_CATEGORY:341 = 3
COM_CATEGORY:342 = 3
COM_CATEGORY:358 = 3
COM_CATEGORY:1311 = 3
COM_CATEGORY:1340 = 3
COM_CATEGORY:1341 = 3
COM_CATEGORY:1342 = 3
COM_CATEGORY:1358 = 3
;既成事実Lv3
;お腹の音、日常フェラ
COM_CATEGORY:326 = 4
COM_CATEGORY:330 = 4
COM_CATEGORY:1326 = 4
COM_CATEGORY:1330 = 4

;キャラの選択
;行動可能なキャラの数を調べる
FOR LOCAL:0, 0, CHARANUM
	IF IS_AUTOSELECT_N(LOCAL:0)
		CHARA_LIST:(CHARA_LIST_MAX) = LOCAL:0
		CHARA_LIST_MAX ++
	ENDIF
NEXT

;中心となるキャラの選択
;全てのキャラの中から等確率で選択
LOCAL:5 = CHARA_LIST:(RAND:(CHARA_LIST_MAX))

;各カテゴリの選択確率を設定
;既成事実0
IF MARK:(LOCAL:5):既成事実 == 0
	CATEGORY_PRIORITY:1 = 100
ELSEIF MARK:(LOCAL:5):既成事実 == 1
	CATEGORY_PRIORITY:1 = 50
ELSEIF MARK:(LOCAL:5):既成事実 == 2
	CATEGORY_PRIORITY:1 = 10
ELSE
	CATEGORY_PRIORITY:1 = 10
ENDIF
LOCAL:1 = MAX(PALAM:(LOCAL:5):怒外, PALAM:(LOCAL:5):哀外, PALAM:(LOCAL:5):怖外)
LOCAL:2 = MAX(PALAM:(LOCAL:5):怒主, PALAM:(LOCAL:5):哀主, PALAM:(LOCAL:5):怖主)
IF LOCAL:1 > LOCAL:2
	CATEGORY_PRIORITY:1 += 30
	CATEGORY_PRIORITY:1 += AUTO_N_TYPE1(LOCAL:5, 1)
	CATEGORY_PRIORITY:1 += AUTO_N_TYPE2(LOCAL:5, 0)
	CATEGORY_PRIORITY:1 += AUTO_N_TYPE3(LOCAL:5, 0)
	CATEGORY_PRIORITY:1 += AUTO_N_TYPE4(LOCAL:5, 0)
	CATEGORY_PRIORITY:1 += AUTO_N_TYPE5(LOCAL:5, 1)
	CATEGORY_PRIORITY:1 += AUTO_N_TYPE6(MASTER, 1)
	CATEGORY_PRIORITY:1 += AUTO_N_TYPE7(LOCAL:5, 1)
	CATEGORY_PRIORITY:1 += AUTO_N_TYPE8(LOCAL:5, 0)
ENDIF
LOCAL:1 = 0
LOCAL:2 = 0

;既成事実1
IF MARK:(LOCAL:5):既成事実 == 0
	CATEGORY_PRIORITY:2 = 0
ELSEIF MARK:(LOCAL:5):既成事実 == 1
	CATEGORY_PRIORITY:2 = 40
ELSEIF MARK:(LOCAL:5):既成事実 == 2
	CATEGORY_PRIORITY:2 = 50
ELSE
	CATEGORY_PRIORITY:2 = 50
ENDIF

;既成事実2
IF MARK:(LOCAL:5):既成事実 == 0
	CATEGORY_PRIORITY:3 = 0
ELSEIF MARK:(LOCAL:5):既成事実 == 1
	CATEGORY_PRIORITY:3 = 10
ELSEIF MARK:(LOCAL:5):既成事実 == 2
	CATEGORY_PRIORITY:3 = 30
ELSE
	CATEGORY_PRIORITY:3 = 40
ENDIF

;既成事実3
IF MARK:(LOCAL:5):既成事実 == 0
	CATEGORY_PRIORITY:4 = 0
ELSEIF MARK:(LOCAL:5):既成事実 == 1
	CATEGORY_PRIORITY:4 = 10
ELSEIF MARK:(LOCAL:5):既成事実 == 2
	CATEGORY_PRIORITY:4 = 10
ELSE
	CATEGORY_PRIORITY:4 = 10
ENDIF

;各カテゴリの優先度を最低値以上にする
CATEGORY_PRIORITY:1 = MAX(CATEGORY_PRIORITY:1, 2)
CATEGORY_PRIORITY:2 = MAX(CATEGORY_PRIORITY:2, 0)
CATEGORY_PRIORITY:3 = MAX(CATEGORY_PRIORITY:3, 0)
CATEGORY_PRIORITY:4 = MAX(CATEGORY_PRIORITY:4, 0)

;カテゴリの予約があった場合、そのカテゴリの選択率を大幅に上昇
IF TFLAG:30 >= 1
	CATEGORY_PRIORITY:(TFLAG:30 % 10) += 1000000
ENDIF

;★
;PRINTL 各カテゴリ選択率の表示
;FOR LOCAL:0, 0, 10
;	PRINTFORML {LOCAL:0}:{CATEGORY_PRIORITY:(LOCAL:0)}
;NEXT

;●各コマンドの実行確率を設定
;既成事実0
;300会話
LOCAL:1 = MAX(PALAM:(LOCAL:5):怒外, PALAM:(LOCAL:5):哀外, PALAM:(LOCAL:5):怖外)
LOCAL:2 = MAX(PALAM:(LOCAL:5):怒主, PALAM:(LOCAL:5):哀主, PALAM:(LOCAL:5):怖主)
IF LOCAL:1 > LOCAL:2
	COM_PRIORITY:300 += 300000
ENDIF
LOCAL:1 = 0
LOCAL:2 = 0
COM_PRIORITY:300 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:300 += AUTO_N_TYPE2(LOCAL:5, 0)
COM_PRIORITY:300 += AUTO_N_TYPE3(LOCAL:5, 0)
COM_PRIORITY:300 += AUTO_N_TYPE4(LOCAL:5, 0)
COM_PRIORITY:300 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:300 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:300 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:300 += AUTO_N_TYPE8(LOCAL:5, 0)
COM_PRIORITY:1300 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:1300 += AUTO_N_TYPE2(LOCAL:5, 0)
COM_PRIORITY:1300 += AUTO_N_TYPE3(LOCAL:5, 0)
COM_PRIORITY:1300 += AUTO_N_TYPE4(LOCAL:5, 0)
COM_PRIORITY:1300 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:1300 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:1300 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:1300 += AUTO_N_TYPE8(LOCAL:5, 0)
;301訓練
COM_PRIORITY:301 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:301 += AUTO_N_TYPE2(LOCAL:5, 0)
COM_PRIORITY:301 += AUTO_N_TYPE3(LOCAL:5, 1)
COM_PRIORITY:301 += AUTO_N_TYPE4(LOCAL:5, 1)
COM_PRIORITY:301 += AUTO_N_TYPE5(LOCAL:5, 0)
COM_PRIORITY:301 += AUTO_N_TYPE8(LOCAL:5, 0)
COM_PRIORITY:1301 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:1301 += AUTO_N_TYPE2(LOCAL:5, 0)
COM_PRIORITY:1301 += AUTO_N_TYPE3(LOCAL:5, 0)
COM_PRIORITY:1301 += AUTO_N_TYPE4(LOCAL:5, 0)
COM_PRIORITY:1301 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:1301 += AUTO_N_TYPE8(LOCAL:5, 0)
;301訓練
COM_PRIORITY:302 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:302 += AUTO_N_TYPE2(LOCAL:5, 0)
COM_PRIORITY:302 += AUTO_N_TYPE3(LOCAL:5, 1)
COM_PRIORITY:302 += AUTO_N_TYPE4(LOCAL:5, 1)
COM_PRIORITY:302 += AUTO_N_TYPE5(LOCAL:5, 0)
COM_PRIORITY:302 += AUTO_N_TYPE8(LOCAL:5, 0)
COM_PRIORITY:1302 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:1302 += AUTO_N_TYPE2(LOCAL:5, 0)
COM_PRIORITY:1302 += AUTO_N_TYPE3(LOCAL:5, 0)
COM_PRIORITY:1302 += AUTO_N_TYPE4(LOCAL:5, 0)
COM_PRIORITY:1302 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:1302 += AUTO_N_TYPE8(LOCAL:5, 0)

;302兵法
COM_PRIORITY:303 += AUTO_N_TYPE1(LOCAL:5, 0)
COM_PRIORITY:303 += AUTO_N_TYPE2(LOCAL:5, 1)
COM_PRIORITY:303 += AUTO_N_TYPE3(LOCAL:5, 1)
COM_PRIORITY:303 += AUTO_N_TYPE4(LOCAL:5, 1)
COM_PRIORITY:303 += AUTO_N_TYPE5(LOCAL:5, 0)
COM_PRIORITY:303 += AUTO_N_TYPE8(LOCAL:5, 0)
COM_PRIORITY:1303 += AUTO_N_TYPE1(LOCAL:5, 0)
COM_PRIORITY:1303 += AUTO_N_TYPE2(LOCAL:5, 1)
COM_PRIORITY:1303 += AUTO_N_TYPE3(LOCAL:5, 0)
COM_PRIORITY:1303 += AUTO_N_TYPE4(LOCAL:5, 0)
COM_PRIORITY:1303 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:1303 += AUTO_N_TYPE8(LOCAL:5, 0)
;303政務
COM_PRIORITY:304 += AUTO_N_TYPE1(LOCAL:5, 0)
COM_PRIORITY:304 += AUTO_N_TYPE2(LOCAL:5, 1)
COM_PRIORITY:304 += AUTO_N_TYPE3(LOCAL:5, 1)
COM_PRIORITY:304 += AUTO_N_TYPE4(LOCAL:5, 1)
COM_PRIORITY:304 += AUTO_N_TYPE5(LOCAL:5, 0)
COM_PRIORITY:304 += AUTO_N_TYPE8(LOCAL:5, 0)
COM_PRIORITY:1304 += AUTO_N_TYPE1(LOCAL:5, 0)
COM_PRIORITY:1304 += AUTO_N_TYPE2(LOCAL:5, 1)
COM_PRIORITY:1304 += AUTO_N_TYPE3(LOCAL:5, 0)
COM_PRIORITY:1304 += AUTO_N_TYPE4(LOCAL:5, 0)
COM_PRIORITY:1304 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:1304 += AUTO_N_TYPE8(LOCAL:5, 0)
;304警邏
COM_PRIORITY:305 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:305 += AUTO_N_TYPE2(LOCAL:5, 0)
COM_PRIORITY:305 += AUTO_N_TYPE3(LOCAL:5, 0)
COM_PRIORITY:305 += AUTO_N_TYPE4(LOCAL:5, 1)
COM_PRIORITY:305 += AUTO_N_TYPE5(LOCAL:5, 0)
COM_PRIORITY:305 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:305 += AUTO_N_TYPE8(LOCAL:5, 0)
COM_PRIORITY:1305 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:1305 += AUTO_N_TYPE2(LOCAL:5, 0)
COM_PRIORITY:1305 += AUTO_N_TYPE3(LOCAL:5, 0)
COM_PRIORITY:1305 += AUTO_N_TYPE4(LOCAL:5, 1)
COM_PRIORITY:1305 += AUTO_N_TYPE5(LOCAL:5, 0)
COM_PRIORITY:1305 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:1305 += AUTO_N_TYPE8(LOCAL:5, 0)
;305歌唱
COM_PRIORITY:306 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:306 += AUTO_N_TYPE2(LOCAL:5, 0)
COM_PRIORITY:306 += AUTO_N_TYPE3(LOCAL:5, 0)
COM_PRIORITY:306 += AUTO_N_TYPE4(LOCAL:5, 0)
COM_PRIORITY:306 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:306 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:306 += AUTO_N_TYPE8(LOCAL:5, 0)
COM_PRIORITY:1306 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:1306 += AUTO_N_TYPE2(LOCAL:5, 0)
COM_PRIORITY:1306 += AUTO_N_TYPE3(LOCAL:5, 0)
COM_PRIORITY:1306 += AUTO_N_TYPE4(LOCAL:5, 0)
COM_PRIORITY:1306 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:1306 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:1306 += AUTO_N_TYPE8(LOCAL:5, 0)
;306料理
COM_PRIORITY:307 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:307 += AUTO_N_TYPE2(LOCAL:5, 1)
COM_PRIORITY:307 += AUTO_N_TYPE3(LOCAL:5, 1)
COM_PRIORITY:307 += AUTO_N_TYPE4(LOCAL:5, 0)
COM_PRIORITY:307 += AUTO_N_TYPE5(LOCAL:5, 0)
COM_PRIORITY:307 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:307 += AUTO_N_TYPE8(LOCAL:5, 0)
COM_PRIORITY:1307 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:1307 += AUTO_N_TYPE2(LOCAL:5, 1)
COM_PRIORITY:1307 += AUTO_N_TYPE3(LOCAL:5, 1)
COM_PRIORITY:1307 += AUTO_N_TYPE4(LOCAL:5, 0)
COM_PRIORITY:1307 += AUTO_N_TYPE5(LOCAL:5, 0)
COM_PRIORITY:1307 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:1307 += AUTO_N_TYPE8(LOCAL:5, 0)
;310酒を飲む
COM_PRIORITY:310 += (TALENT:(LOCAL:5):酒豪) * 7
COM_PRIORITY:310 += (TALENT:(LOCAL:5):サボり魔) * 3
SIF (TALENT:(LOCAL:5):幼稚) || (TALENT:(LOCAL:5):下戸) - 7
	COM_PRIORITY:310 = 1
COM_PRIORITY:1310 += (TALENT:(LOCAL:5):酒豪) * 4
COM_PRIORITY:1310 += (TALENT:(LOCAL:5):サボり魔) * 6
COM_PRIORITY:1310 += (TALENT:(LOCAL:5):服従) * 2 + (TALENT:(LOCAL:5):隷属) * 2
IF TALENT:(LOCAL:5):幼稚
	COM_PRIORITY:1310 = 0
	COM_PRIORITY:1310 += (ITEM:果実酒) * 3
ELSE
	COM_PRIORITY:1310 += (ITEM:醸造酒 || ITEM:日本酒 || ITEM:蒸留酒) * 5
ENDIF

;既成事実1
;307猥談
COM_PRIORITY:309 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:309 += AUTO_N_TYPE2(LOCAL:5, 0)
COM_PRIORITY:309 += AUTO_N_TYPE3(LOCAL:5, 0)
COM_PRIORITY:309 += AUTO_N_TYPE4(LOCAL:5, 0)
COM_PRIORITY:309 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:309 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:309 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:309 += AUTO_N_TYPE8(LOCAL:5, 0)
COM_PRIORITY:1307 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:1307 += AUTO_N_TYPE2(LOCAL:5, 0)
COM_PRIORITY:1307 += AUTO_N_TYPE3(LOCAL:5, 0)
COM_PRIORITY:1307 += AUTO_N_TYPE4(LOCAL:5, 0)
COM_PRIORITY:1307 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:1307 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:1307 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:1307 += AUTO_N_TYPE8(LOCAL:5, 0)
;320スキンシップ
COM_PRIORITY:320 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:320 += AUTO_N_TYPE2(LOCAL:5, 1)
COM_PRIORITY:320 += AUTO_N_TYPE3(LOCAL:5, 1)
COM_PRIORITY:320 += AUTO_N_TYPE4(LOCAL:5, 1)
COM_PRIORITY:320 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:320 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:320 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:320 += AUTO_N_TYPE8(LOCAL:5, 0)
COM_PRIORITY:1320 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:1320 += AUTO_N_TYPE2(LOCAL:5, 1)
COM_PRIORITY:1320 += AUTO_N_TYPE3(LOCAL:5, 1)
COM_PRIORITY:1320 += AUTO_N_TYPE4(LOCAL:5, 0)
COM_PRIORITY:1320 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:1320 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:1320 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:1320 += AUTO_N_TYPE8(LOCAL:5, 0)
;321頭を撫でる
COM_PRIORITY:321 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:321 += AUTO_N_TYPE2(LOCAL:5, 1)
COM_PRIORITY:321 += AUTO_N_TYPE3(LOCAL:5, 1)
COM_PRIORITY:321 += AUTO_N_TYPE4(LOCAL:5, 1)
COM_PRIORITY:321 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:321 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:321 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:321 += AUTO_N_TYPE8(LOCAL:5, 0)
COM_PRIORITY:1321 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:1321 += AUTO_N_TYPE2(LOCAL:5, 1)
COM_PRIORITY:1321 += AUTO_N_TYPE3(LOCAL:5, 1)
COM_PRIORITY:1321 += AUTO_N_TYPE4(LOCAL:5, 0)
COM_PRIORITY:1321 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:1321 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:1321 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:1321 += AUTO_N_TYPE8(LOCAL:5, 0)
;322髪を梳く
COM_PRIORITY:322 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:322 += AUTO_N_TYPE2(LOCAL:5, 1)
COM_PRIORITY:322 += AUTO_N_TYPE3(LOCAL:5, 1)
COM_PRIORITY:322 += AUTO_N_TYPE4(LOCAL:5, 1)
COM_PRIORITY:322 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:322 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:322 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:322 += AUTO_N_TYPE8(LOCAL:5, 0)
COM_PRIORITY:1322 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:1322 += AUTO_N_TYPE2(LOCAL:5, 1)
COM_PRIORITY:1322 += AUTO_N_TYPE3(LOCAL:5, 1)
COM_PRIORITY:1322 += AUTO_N_TYPE4(LOCAL:5, 0)
COM_PRIORITY:1322 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:1322 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:1322 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:1322 += AUTO_N_TYPE8(LOCAL:5, 0)
;323櫛で梳かす
COM_PRIORITY:323 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:323 += AUTO_N_TYPE2(LOCAL:5, 1)
COM_PRIORITY:323 += AUTO_N_TYPE3(LOCAL:5, 1)
COM_PRIORITY:323 += AUTO_N_TYPE4(LOCAL:5, 1)
COM_PRIORITY:323 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:323 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:323 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:323 += AUTO_N_TYPE8(LOCAL:5, 0)
COM_PRIORITY:1323 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:1323 += AUTO_N_TYPE2(LOCAL:5, 1)
COM_PRIORITY:1323 += AUTO_N_TYPE3(LOCAL:5, 1)
COM_PRIORITY:1323 += AUTO_N_TYPE4(LOCAL:5, 0)
COM_PRIORITY:1323 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:1323 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:1323 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:1323 += AUTO_N_TYPE8(LOCAL:5, 0)
;324甘い言葉
COM_PRIORITY:324 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:324 += AUTO_N_TYPE2(LOCAL:5, 1)
COM_PRIORITY:324 += AUTO_N_TYPE3(LOCAL:5, 0)
COM_PRIORITY:324 += AUTO_N_TYPE4(LOCAL:5, 0)
COM_PRIORITY:324 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:324 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:324 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:324 += AUTO_N_TYPE8(LOCAL:5, 0)
COM_PRIORITY:1324 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:1324 += AUTO_N_TYPE2(LOCAL:5, 1)
COM_PRIORITY:1324 += AUTO_N_TYPE3(LOCAL:5, 0)
COM_PRIORITY:1324 += AUTO_N_TYPE4(LOCAL:5, 1)
COM_PRIORITY:1324 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:1324 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:1324 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:1324 += AUTO_N_TYPE8(LOCAL:5, 0)
;325見つめ合う
COM_PRIORITY:325 += AUTO_N_TYPE1(LOCAL:5, 0)
COM_PRIORITY:325 += AUTO_N_TYPE2(LOCAL:5, 1)
COM_PRIORITY:325 += AUTO_N_TYPE3(LOCAL:5, 1)
COM_PRIORITY:325 += AUTO_N_TYPE4(LOCAL:5, 1)
COM_PRIORITY:325 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:325 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:325 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:325 += AUTO_N_TYPE8(LOCAL:5, 0)
COM_PRIORITY:1325 += AUTO_N_TYPE1(LOCAL:5, 0)
COM_PRIORITY:1325 += AUTO_N_TYPE2(LOCAL:5, 1)
COM_PRIORITY:1325 += AUTO_N_TYPE3(LOCAL:5, 1)
COM_PRIORITY:1325 += AUTO_N_TYPE4(LOCAL:5, 1)
COM_PRIORITY:1325 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:1325 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:1325 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:1325 += AUTO_N_TYPE8(LOCAL:5, 0)
;351食事
COM_PRIORITY:351 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:351 += AUTO_N_TYPE2(LOCAL:5, 1)
COM_PRIORITY:351 += AUTO_N_TYPE3(LOCAL:5, 1)
COM_PRIORITY:351 += AUTO_N_TYPE4(LOCAL:5, 1)
COM_PRIORITY:351 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:351 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:351 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:351 += AUTO_N_TYPE8(LOCAL:5, 0)
COM_PRIORITY:1351 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:1351 += AUTO_N_TYPE2(LOCAL:5, 1)
COM_PRIORITY:1351 += AUTO_N_TYPE3(LOCAL:5, 1)
COM_PRIORITY:1351 += AUTO_N_TYPE4(LOCAL:5, 1)
COM_PRIORITY:1351 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:1351 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:1351 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:1351 += AUTO_N_TYPE8(LOCAL:5, 0)

;354水浴び
COM_PRIORITY:354 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:354 += AUTO_N_TYPE2(LOCAL:5, 0)
COM_PRIORITY:354 += AUTO_N_TYPE3(LOCAL:5, 1)
COM_PRIORITY:354 += AUTO_N_TYPE4(LOCAL:5, 1)
COM_PRIORITY:354 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:354 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:354 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:354 += AUTO_N_TYPE8(LOCAL:5, 0)
COM_PRIORITY:1354 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:1354 += AUTO_N_TYPE2(LOCAL:5, 0)
COM_PRIORITY:1354 += AUTO_N_TYPE3(LOCAL:5, 1)
COM_PRIORITY:1354 += AUTO_N_TYPE4(LOCAL:5, 1)
COM_PRIORITY:1354 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:1354 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:1354 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:1354 += AUTO_N_TYPE8(LOCAL:5, 0)
;355泳ぐ
COM_PRIORITY:355 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:355 += AUTO_N_TYPE2(LOCAL:5, 0)
COM_PRIORITY:355 += AUTO_N_TYPE3(LOCAL:5, 1)
COM_PRIORITY:355 += AUTO_N_TYPE4(LOCAL:5, 1)
COM_PRIORITY:355 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:355 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:355 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:355 += AUTO_N_TYPE8(LOCAL:5, 0)
COM_PRIORITY:1355 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:1355 += AUTO_N_TYPE2(LOCAL:5, 0)
COM_PRIORITY:1355 += AUTO_N_TYPE3(LOCAL:5, 1)
COM_PRIORITY:1355 += AUTO_N_TYPE4(LOCAL:5, 1)
COM_PRIORITY:1355 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:1355 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:1355 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:1355 += AUTO_N_TYPE8(LOCAL:5, 0)
;356花冠
COM_PRIORITY:356 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:356 += AUTO_N_TYPE2(LOCAL:5, 1)
COM_PRIORITY:356 += AUTO_N_TYPE3(LOCAL:5, 0)
COM_PRIORITY:356 += AUTO_N_TYPE4(LOCAL:5, 1)
COM_PRIORITY:356 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:356 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:356 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:356 += AUTO_N_TYPE8(LOCAL:5, 0)
COM_PRIORITY:1356 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:1356 += AUTO_N_TYPE2(LOCAL:5, 1)
COM_PRIORITY:1356 += AUTO_N_TYPE3(LOCAL:5, 0)
COM_PRIORITY:1356 += AUTO_N_TYPE4(LOCAL:5, 1)
COM_PRIORITY:1356 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:1356 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:1356 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:1356 += AUTO_N_TYPE8(LOCAL:5, 0)
;357狩りをする
COM_PRIORITY:357 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:357 += AUTO_N_TYPE2(LOCAL:5, 0)
COM_PRIORITY:357 += AUTO_N_TYPE3(LOCAL:5, 1)
COM_PRIORITY:357 += AUTO_N_TYPE4(LOCAL:5, 1)
COM_PRIORITY:357 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:357 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:357 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:357 += AUTO_N_TYPE8(LOCAL:5, 0)
COM_PRIORITY:1357 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:1357 += AUTO_N_TYPE2(LOCAL:5, 0)
COM_PRIORITY:1357 += AUTO_N_TYPE3(LOCAL:5, 1)
COM_PRIORITY:1357 += AUTO_N_TYPE4(LOCAL:5, 1)
COM_PRIORITY:1357 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:1357 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:1357 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:1357 += AUTO_N_TYPE8(LOCAL:5, 0)
;390二人で出かける
COM_PRIORITY:390 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:390 += AUTO_N_TYPE2(LOCAL:5, 1)
COM_PRIORITY:390 += AUTO_N_TYPE3(LOCAL:5, 1)
COM_PRIORITY:390 += AUTO_N_TYPE4(LOCAL:5, 1)
COM_PRIORITY:390 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:390 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:390 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:390 += AUTO_N_TYPE8(LOCAL:5, 0)
COM_PRIORITY:1390 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:1390 += AUTO_N_TYPE2(LOCAL:5, 1)
COM_PRIORITY:1390 += AUTO_N_TYPE3(LOCAL:5, 1)
COM_PRIORITY:1390 += AUTO_N_TYPE4(LOCAL:5, 1)
COM_PRIORITY:1390 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:1390 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:1390 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:1390 += AUTO_N_TYPE8(LOCAL:5, 0)
;391移動
COM_PRIORITY:391 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:391 += AUTO_N_TYPE2(LOCAL:5, 1)
COM_PRIORITY:391 += AUTO_N_TYPE3(LOCAL:5, 1)
COM_PRIORITY:391 += AUTO_N_TYPE4(LOCAL:5, 1)
COM_PRIORITY:391 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:391 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:391 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:391 += AUTO_N_TYPE8(LOCAL:5, 0)
COM_PRIORITY:1391 += AUTO_N_TYPE1(LOCAL:5, 1)
COM_PRIORITY:1391 += AUTO_N_TYPE2(LOCAL:5, 1)
COM_PRIORITY:1391 += AUTO_N_TYPE3(LOCAL:5, 1)
COM_PRIORITY:1391 += AUTO_N_TYPE4(LOCAL:5, 1)
COM_PRIORITY:1391 += AUTO_N_TYPE5(LOCAL:5, 1)
COM_PRIORITY:1391 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:1391 += AUTO_N_TYPE7(LOCAL:5, 1)
COM_PRIORITY:1391 += AUTO_N_TYPE8(LOCAL:5, 0)
;392帰る
COM_PRIORITY:392 += AUTO_N_TYPE1(LOCAL:5, 0)
COM_PRIORITY:392 += AUTO_N_TYPE2(LOCAL:5, 0)
COM_PRIORITY:392 += AUTO_N_TYPE3(LOCAL:5, 0)
COM_PRIORITY:392 += AUTO_N_TYPE4(LOCAL:5, 0)
COM_PRIORITY:392 += AUTO_N_TYPE5(LOCAL:5, 0)
COM_PRIORITY:392 += AUTO_N_TYPE6(MASTER, 0)
COM_PRIORITY:392 += AUTO_N_TYPE7(LOCAL:5, 0)
COM_PRIORITY:392 += AUTO_N_TYPE8(LOCAL:5, 1)
COM_PRIORITY:1392 += AUTO_N_TYPE1(LOCAL:5, 0)
COM_PRIORITY:1392 += AUTO_N_TYPE2(LOCAL:5, 0)
COM_PRIORITY:1392 += AUTO_N_TYPE3(LOCAL:5, 0)
COM_PRIORITY:1392 += AUTO_N_TYPE4(LOCAL:5, 0)
COM_PRIORITY:1392 += AUTO_N_TYPE5(LOCAL:5, 0)
COM_PRIORITY:1392 += AUTO_N_TYPE6(MASTER, 0)
COM_PRIORITY:1392 += AUTO_N_TYPE7(LOCAL:5, 0)
COM_PRIORITY:1392 += AUTO_N_TYPE8(LOCAL:5, 1)

;既成事実2
;340バードキス
COM_PRIORITY:340 += AUTO_N_TYPE2(LOCAL:5, 0)
COM_PRIORITY:340 += AUTO_N_TYPE4(LOCAL:5, 1)
COM_PRIORITY:340 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:340 += AUTO_N_TYPE7(LOCAL:5, 1) * RAND:4
COM_PRIORITY:340 += AUTO_N_TYPE8(LOCAL:5, 0)
COM_PRIORITY:1340 += AUTO_N_TYPE2(LOCAL:5, 1)
COM_PRIORITY:1340 += AUTO_N_TYPE4(LOCAL:5, 0)
COM_PRIORITY:1340 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:1340 += AUTO_N_TYPE7(LOCAL:5, 1) * RAND:4
COM_PRIORITY:1340 += AUTO_N_TYPE8(LOCAL:5, 0)
;341ソフトキス
COM_PRIORITY:341 += AUTO_N_TYPE2(LOCAL:5, 0)
COM_PRIORITY:341 += AUTO_N_TYPE4(LOCAL:5, 1)
COM_PRIORITY:341 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:341 += AUTO_N_TYPE7(LOCAL:5, 1) * RAND:4
COM_PRIORITY:341 += AUTO_N_TYPE8(LOCAL:5, 0)
COM_PRIORITY:1341 += AUTO_N_TYPE2(LOCAL:5, 1)
COM_PRIORITY:1341 += AUTO_N_TYPE4(LOCAL:5, 0)
COM_PRIORITY:1341 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:1341 += AUTO_N_TYPE7(LOCAL:5, 1) * RAND:4
COM_PRIORITY:1341 += AUTO_N_TYPE8(LOCAL:5, 0)
;342ディープキス
COM_PRIORITY:342 += AUTO_N_TYPE2(LOCAL:5, 0)
COM_PRIORITY:342 += AUTO_N_TYPE4(LOCAL:5, 1)
COM_PRIORITY:342 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:342 += AUTO_N_TYPE7(LOCAL:5, 1) * RAND:4
COM_PRIORITY:342 += AUTO_N_TYPE8(LOCAL:5, 0)
COM_PRIORITY:1342 += AUTO_N_TYPE2(LOCAL:5, 1)
COM_PRIORITY:1342 += AUTO_N_TYPE4(LOCAL:5, 0)
COM_PRIORITY:1342 += AUTO_N_TYPE6(MASTER, 1)
COM_PRIORITY:1342 += AUTO_N_TYPE7(LOCAL:5, 1) * RAND:4
COM_PRIORITY:1342 += AUTO_N_TYPE8(LOCAL:5, 0)
;358背中を流す
COM_PRIORITY:358 += AUTO_N_TYPE7(LOCAL:5, 1) * RAND:4
COM_PRIORITY:358 += AUTO_N_TYPE8(LOCAL:5, 0)
COM_PRIORITY:358 += AUTO_N_TYPE7(LOCAL:5, 1) * RAND:4
COM_PRIORITY:358 += AUTO_N_TYPE8(LOCAL:5, 0)

;既成事実3
;蜂蜜水
COM_PRIORITY:311 += AUTO_N_TYPE7(LOCAL:5, 1) + (TALENT:(LOCAL:5):幼稚) * 5
COM_PRIORITY:1311 += AUTO_N_TYPE7(LOCAL:5, 1) + (TALENT:(LOCAL:5):幼稚) * 5
COM_PRIORITY:1330 = 0
IF MARK:(LOCAL:5):2 > 2
	COM_PRIORITY:1330 += AUTO_N_TYPE5(LOCAL:5, 1)
	COM_PRIORITY:1330 += AUTO_N_TYPE7(LOCAL:5, 1)
	COM_PRIORITY:1330 += AUTO_N_TYPE8(LOCAL:5, 0)
ENDIF

;●前回実行したコマンドの優先度を1/4にする
IF PREVCOM >= 0
	IF PREVCOM_TYPE == 0
		COM_PRIORITY:(PREVCOM + 1000) /= 4
	ELSEIF PREVCOM_TYPE == 1
		COM_PRIORITY:PREVCOM /= 4
	ELSE
		COM_PRIORITY:(PREVCOM + 2000) /= 4
	ENDIF
ENDIF

;●選択不可能なコマンドの優先度を0にする
;コマンド判定フラグON
COM_ENABLE = 1

;主導権を中心となるキャラに渡す
FLAG:主導権所有者 = LOCAL:5

CALL CLEAR_MPLY()
CALL CLEAR_MTAR()
CALL ADD_MPLY(LOCAL:5)
CALL ADD_MTAR(MASTER)
FOR LOCAL:0, 0, 1000
	RESULT = 0
	TRYCALLFORM COM_ABLE{LOCAL:0}
	IF !RESULT
		COM_PRIORITY:(LOCAL:0) = 0
	ENDIF
NEXT
CALL CLEAR_MPLY()
CALL CLEAR_MTAR()
CALL ADD_MPLY(MASTER)
CALL ADD_MTAR(LOCAL:5)
FOR LOCAL:0, 0, 1000
	RESULT = 0
	TRYCALLFORM COM_ABLE{LOCAL:0}
	IF !RESULT
		COM_PRIORITY:(LOCAL:0 + 1000) = 0
	ENDIF
NEXT

;コマンド判定フラグOFF
COM_ENABLE = 0

;●コマンドの優先度をカテゴリごとの実行確率に合わせて正規化
LOCAL:80 = 0
FOR LOCAL:0, 0, 10
	LOCAL:80 += CATEGORY_PRIORITY:(LOCAL:0)
NEXT
IF LOCAL:80 >= 1
	FOR LOCAL:0, 0, 10
		CATEGORY_PRIORITY:(LOCAL:0) = CATEGORY_PRIORITY:(LOCAL:0) * 10000 / LOCAL:80
	NEXT
ELSE
	CATEGORY_PRIORITY:1 = 10000
ENDIF

FOR LOCAL:0, 0, 3000
	COM_PRIORITY_SUM:(COM_CATEGORY:(LOCAL:0)) += MAX(COM_PRIORITY:(LOCAL:0), 0)
NEXT
FOR LOCAL:0, 0, 3000
	IF COM_PRIORITY:(LOCAL:0) > 0
		LOCAL:50 = COM_PRIORITY_SUM:(COM_CATEGORY:(LOCAL:0))
		LOCAL:51 = CATEGORY_PRIORITY:(COM_CATEGORY:(LOCAL:0))
		IF LOCAL:50 >= 1 && LOCAL:51 >= 1
			COM_PRIORITY:(LOCAL:0) = COM_PRIORITY:(LOCAL:0) * LOCAL:51 * 100 / LOCAL:50
		ELSE
			COM_PRIORITY:(LOCAL:0) = 0
		ENDIF
	ENDIF
NEXT

;★
;PRINTL コマンド実行値の表示
;FOR LOCAL:0, 0, 2000
;	IF COM_PRIORITY:(LOCAL:0) > 0
;		PRINTFORML {LOCAL:0, 3}:{COM_PRIORITY:(LOCAL:0)}
;	ENDIF
;NEXT

;★
;PRINTL 各カテゴリ選択率の表示
;FOR LOCAL:0, 0, 10
;	PRINTFORML {LOCAL:0}:{CATEGORY_PRIORITY:(LOCAL:0)}
;NEXT

;●コマンドフィルタの反映

LOCAL:1 = 0
;モード別のコマンドを走査
FOR LOCAL:0, 0, VARSIZE("TRAINNAME")
	SIF TRAINNAME:(LOCAL:0) == ""
		CONTINUE
	;実行可能かどうかを判定
	CALL CHECK_COM_AVAILABLE(LOCAL)
	IF !RESULT || COM_FILTER:(LOCAL:0)
		COM_PRIORITY:(LOCAL:0) = 0
		COM_PRIORITY:(1000+LOCAL:0) = 0
	ENDIF
NEXT

;★
;PRINTL コマンド実行値の表示
;FOR LOCAL:0, 0, 2000
;	IF COM_PRIORITY:(LOCAL:0) > 0
;		PRINTFORML {LOCAL:0, 3}:{COM_PRIORITY:(LOCAL:0)}
;	ENDIF
;NEXT

;●実行するコマンドを決定
LOCAL:9 = 0
LOCAL:10 = 0
FOR LOCAL:0, 0, 3000
	LOCAL:10 += MAX(COM_PRIORITY:(LOCAL:0), 0)
NEXT
IF LOCAL:10 >= 1
	CATEGORY_PRIORITY:1 = RAND:(LOCAL:10)
	FOR LOCAL:0, 0, 3000
		CATEGORY_PRIORITY:1 -= MAX(COM_PRIORITY:(LOCAL:0), 0)
		IF CATEGORY_PRIORITY:1 < 0
			LOCAL:9 = LOCAL:0
			BREAK
		ENDIF
	NEXT
ENDIF

CALL CLEAR_MPLY()
CALL CLEAR_MTAR()

;メインの実行者・対象者の設定
IF LOCAL:9 < 1000
	CALL ADD_MPLY(LOCAL:5)
	CALL ADD_MTAR(MASTER)
ELSEIF LOCAL:9 < 2000
	CALL ADD_MPLY(MASTER)
	CALL ADD_MTAR(LOCAL:5)
ELSE
ENDIF

LOCAL:10 = LOCAL:9 % 1000
CATEGORY_PRIORITY:1 = LOCAL:10 + LOCAL:9 / 1000 * 300

;●継続状態の設定
RESULT = 0
TRYCALLFORM COM_IS_EQUIP{LOCAL:10}
;継続状態が不可能なコマンドの場合
IF RESULT == 0
	;非継続フラグON
	TFLAG:1 = 1
;常に継続状態で実行されるコマンドの場合
ELSEIF RESULT == 2
	;非継続フラグOFF
	TFLAG:1 = 0
;継続、非継続のどちらでも可能なコマンドの場合
ELSE
	LOCAL:12 = COM_TENDENCY:(LOCAL:5):(LOCAL:10)
	LOCAL:20 = 15
	LOCAL:21 = 40
	LOCAL:22 = 80
	LOCAL:23 = 100
	IF RAND:100 < LOCAL:(LOCAL:12 + 20)
		;非継続フラグOFF
		TFLAG:1 = 0
	ELSE
		;非継続フラグON
		TFLAG:1 = 1
	ENDIF
ENDIF

DOTRAIN LOCAL:10

;-------------------------------------------------
;主導度Ｎによる補正値を取得する関数  ARG:0=キャラ番号
;-------------------------------------------------
@GET_INITIATIVE_N_RANK(ARG:0)
#FUNCTION
IF GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_サド)
	RETURNF 6
ELSEIF ABL:(ARG:0):主導度Ｎ >= 500
	RETURNF 5
ELSEIF ABL:(ARG:0):主導度Ｎ >= 300
	RETURNF 3
ELSEIF ABL:(ARG:0):主導度Ｎ >= 100
	RETURNF 1
ELSEIF ABL:(ARG:0):主導度Ｎ > -100
	RETURNF 0
ELSEIF ABL:(ARG:0):主導度Ｎ > -300
	RETURNF -1
ELSEIF ABL:(ARG:0):主導度Ｎ > -500
	RETURNF -3
ELSE
	RETURNF -5
ENDIF

;-------------------------------------------------
;タイプによる補正値を取得する関数  ARG:0=キャラ番号 ARG:1 1=加算 0=減算
;-------------------------------------------------
;type1 活発
@AUTO_N_TYPE1(ARG:0, ARG:1)
#FUNCTION
LOCAL:100 = 0
IF ARG:1 == 1
	LOCAL:100 += (TALENT:(ARG:0):素直) * 2
	LOCAL:100 += (TALENT:(ARG:0):楽観的) * 2
	LOCAL:100 += (TALENT:(ARG:0):目立ちたがり) * 2
	LOCAL:100 += (TALENT:(ARG:0):解放) * 2
	LOCAL:100 += (TALENT:(ARG:0):恥薄い) * 2
	LOCAL:100 += (TALENT:(ARG:0):生意気) * 2
	LOCAL:100 += (TALENT:(ARG:0):反抗的) * 2
	LOCAL:100 += (TALENT:(ARG:0):ツンデレ) * 2
	LOCAL:100 += (TALENT:(ARG:0):小悪魔) * 2
	LOCAL:100 += (TALENT:(ARG:0):幼稚) * 2
ELSE
	LOCAL:100 = 20
	LOCAL:100 -= (TALENT:(ARG:0):素直) * 2
	LOCAL:100 -= (TALENT:(ARG:0):楽観的) * 2
	LOCAL:100 -= (TALENT:(ARG:0):目立ちたがり) * 2
	LOCAL:100 -= (TALENT:(ARG:0):解放) * 2
	LOCAL:100 -= (TALENT:(ARG:0):恥薄い) * 2
	LOCAL:100 -= (TALENT:(ARG:0):生意気) * 2
	LOCAL:100 -= (TALENT:(ARG:0):反抗的) * 2
	LOCAL:100 -= (TALENT:(ARG:0):ツンデレ) * 2
	LOCAL:100 -= (TALENT:(ARG:0):小悪魔) * 2
	LOCAL:100 -= (TALENT:(ARG:0):幼稚) * 2
ENDIF
RETURNF LOCAL:100

;type2 大人しい
@AUTO_N_TYPE2(ARG:0, ARG:1)
#FUNCTION
LOCAL:100 = 0
IF ARG:1 == 1
	LOCAL:100 += (TALENT:(ARG:0):臆病) * 2
	LOCAL:100 += (TALENT:(ARG:0):大人しい) * 2
	LOCAL:100 += (TALENT:(ARG:0):保守的) * 2
	LOCAL:100 += (TALENT:(ARG:0):悲観的) * 2
	LOCAL:100 += (TALENT:(ARG:0):プライド低い) * 2
	LOCAL:100 += (TALENT:(ARG:0):習得遅い) * 2
	LOCAL:100 += (TALENT:(ARG:0):献身的) * 2
	LOCAL:100 += (TALENT:(ARG:0):恥じらい) * 2
	LOCAL:100 += (TALENT:(ARG:0):Ｍ気質) * 2
	LOCAL:100 += GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_マゾ) * 2
ELSE
	LOCAL:100 = 20
	LOCAL:100 -= (TALENT:(ARG:0):臆病) * 2
	LOCAL:100 -= (TALENT:(ARG:0):大人しい) * 2
	LOCAL:100 -= (TALENT:(ARG:0):保守的) * 2
	LOCAL:100 -= (TALENT:(ARG:0):悲観的) * 2
	LOCAL:100 -= (TALENT:(ARG:0):プライド低い) * 2
	LOCAL:100 -= (TALENT:(ARG:0):習得遅い) * 2
	LOCAL:100 -= (TALENT:(ARG:0):献身的) * 2
	LOCAL:100 -= (TALENT:(ARG:0):恥じらい) * 2
	LOCAL:100 -= (TALENT:(ARG:0):Ｍ気質) * 2
	LOCAL:100 -= GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_マゾ) * 2
ENDIF
RETURNF LOCAL:100

;type3 クール
@AUTO_N_TYPE3(ARG:0, ARG:1)
#FUNCTION
LOCAL:100 = 0
IF ARG:1 == 1
	LOCAL:100 += (TALENT:(ARG:0):自制心) * 2
	LOCAL:100 += (TALENT:(ARG:0):無関心) * 2
	LOCAL:100 += (TALENT:(ARG:0):感情乏しい) * 2
	LOCAL:100 += (TALENT:(ARG:0):好奇心) * 2
	LOCAL:100 += (TALENT:(ARG:0):抑圧) * 2
	LOCAL:100 += (TALENT:(ARG:0):孤高) * 2
	LOCAL:100 += (TALENT:(ARG:0):濡れにくい) * 2
	LOCAL:100 += FIND_PASSIVE_SKILL(ARG:0, "努力家") * 2
ELSE
	LOCAL:100 = 16
	LOCAL:100 -= (TALENT:(ARG:0):自制心) * 2
	LOCAL:100 -= (TALENT:(ARG:0):無関心) * 2
	LOCAL:100 -= (TALENT:(ARG:0):感情乏しい) * 2
	LOCAL:100 -= (TALENT:(ARG:0):好奇心) * 2
	LOCAL:100 -= (TALENT:(ARG:0):抑圧) * 2
	LOCAL:100 -= (TALENT:(ARG:0):孤高) * 2
	LOCAL:100 -= (TALENT:(ARG:0):濡れにくい) * 2
	LOCAL:100 -= FIND_PASSIVE_SKILL(ARG:0, "努力家") * 2
ENDIF
RETURNF LOCAL:100

;type4 凛としている
@AUTO_N_TYPE4(ARG:0, ARG:1)
#FUNCTION
LOCAL:100 = 0
IF ARG:1 == 1
	LOCAL:100 += (TALENT:(ARG:0):気丈) * 2
	LOCAL:100 += (TALENT:(ARG:0):プライド高い) * 2
	LOCAL:100 += (TALENT:(ARG:0):一線越えない) * 2
	LOCAL:100 += (TALENT:(ARG:0):貞操観念) * 2
	LOCAL:100 += (TALENT:(ARG:0):習得早い) * 2
	LOCAL:100 += (TALENT:(ARG:0):痛みに強い) * 2
	LOCAL:100 += (TALENT:(ARG:0):汚臭敏感) * 2
	LOCAL:100 += (TALENT:(ARG:0):快感の否定) * 2
	LOCAL:100 += (TALENT:(ARG:0):Ｓ気質) * 2
	LOCAL:100 += GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_サド) * 2
ELSE
	LOCAL:100 = 20
	LOCAL:100 -= (TALENT:(ARG:0):気丈) * 2
	LOCAL:100 -= (TALENT:(ARG:0):プライド高い) * 2
	LOCAL:100 -= (TALENT:(ARG:0):一線越えない) * 2
	LOCAL:100 -= (TALENT:(ARG:0):貞操観念) * 2
	LOCAL:100 -= (TALENT:(ARG:0):習得早い) * 2
	LOCAL:100 -= (TALENT:(ARG:0):痛みに強い) * 2
	LOCAL:100 -= (TALENT:(ARG:0):汚臭敏感) * 2
	LOCAL:100 -= (TALENT:(ARG:0):快感の否定) * 2
	LOCAL:100 -= (TALENT:(ARG:0):Ｓ気質) * 2
	LOCAL:100 -= GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_サド) * 2
ENDIF
RETURNF LOCAL:100

;type5 遊び人
@AUTO_N_TYPE5(ARG:0, ARG:1)
#FUNCTION
LOCAL:100 = 0
IF ARG:1 == 1
	LOCAL:100 += (TALENT:(ARG:0):サボり魔) * 2
	LOCAL:100 += (TALENT:(ARG:0):痛みに弱い) * 2
	LOCAL:100 += (TALENT:(ARG:0):濡れやすい) * 2
	LOCAL:100 += (TALENT:(ARG:0):舌使い) * 2
	LOCAL:100 += (TALENT:(ARG:0):自慰しやすい) * 2
	LOCAL:100 += (TALENT:(ARG:0):貞操無頓着) * 2
	LOCAL:100 += (TALENT:(ARG:0):汚臭鈍感) * 2
	LOCAL:100 += (TALENT:(ARG:0):汚れ無視) * 2
	LOCAL:100 += (TALENT:(ARG:0):快感に素直) * 2
	LOCAL:100 += (TALENT:(ARG:0):中毒しやすい) * 2
	LOCAL:100 += (TALENT:(ARG:0):倒錯的) * 2
	LOCAL:100 += GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_淫乱) * 2
	LOCAL:100 += GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_蕩唇) * 2
	LOCAL:100 += GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_射精狂い) * 2
ELSE
	LOCAL:100 = 28
	LOCAL:100 -= (TALENT:(ARG:0):サボり魔) * 2
	LOCAL:100 -= (TALENT:(ARG:0):痛みに弱い) * 2
	LOCAL:100 -= (TALENT:(ARG:0):濡れやすい) * 2
	LOCAL:100 -= (TALENT:(ARG:0):舌使い) * 2
	LOCAL:100 -= (TALENT:(ARG:0):自慰しやすい) * 2
	LOCAL:100 -= (TALENT:(ARG:0):貞操無頓着) * 2
	LOCAL:100 -= (TALENT:(ARG:0):汚臭鈍感) * 2
	LOCAL:100 -= (TALENT:(ARG:0):汚れ無視) * 2
	LOCAL:100 -= (TALENT:(ARG:0):快感に素直) * 2
	LOCAL:100 -= (TALENT:(ARG:0):中毒しやすい) * 2
	LOCAL:100 -= (TALENT:(ARG:0):倒錯的) * 2
	LOCAL:100 -= GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_淫乱) * 2
	LOCAL:100 -= GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_蕩唇) * 2
	LOCAL:100 -= GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_射精狂い) * 2
ENDIF
RETURNF LOCAL:100

;type6 魅了
@AUTO_N_TYPE6(ARG:0, ARG:1)
#FUNCTION
LOCAL:100 = 0
IF ARG:1 == 1
	LOCAL:100 += (TALENT:(ARG:0):魅惑) * 2
	LOCAL:100 += (TALENT:(ARG:0):謎の魅力) * 2
	LOCAL:100 += (TALENT:(ARG:0):人気) * 2
	LOCAL:100 += (TALENT:(ARG:0):天の御遣い) * 2
ELSE
	LOCAL:100 = 8
	LOCAL:100 -= (TALENT:(ARG:0):魅惑) * 2
	LOCAL:100 -= (TALENT:(ARG:0):謎の魅力) * 2
	LOCAL:100 -= (TALENT:(ARG:0):人気) * 2
	LOCAL:100 -= (TALENT:(ARG:0):天の御遣い) * 2
ENDIF
RETURNF LOCAL:100

;type7 陥落や既成事実
@AUTO_N_TYPE7(ARG:0, ARG:1)
#FUNCTION
LOCAL:100 = 0
IF ARG:1 == 1
	LOCAL:100 += (TALENT:(ARG:0):恋慕) * 2
	LOCAL:100 += (TALENT:(ARG:0):親友) * 2
	LOCAL:100 += (TALENT:(ARG:0):親愛) * 5
	LOCAL:100 += (TALENT:(ARG:0):服従) * 2
	LOCAL:100 += (TALENT:(ARG:0):隷属) * 5
	LOCAL:100 += (TALENT:(ARG:0):恋人) * 2
	LOCAL:100 += (TALENT:(ARG:0):烙印) * 2
	LOCAL:100 += (TALENT:(ARG:0):合意) * 2
	LOCAL:100 += (TALENT:(ARG:0):正妻) * 5
ELSE
	LOCAL:100 = 27
	LOCAL:100 -= (TALENT:(ARG:0):恋慕) * 2
	LOCAL:100 -= (TALENT:(ARG:0):親友) * 2
	LOCAL:100 -= (TALENT:(ARG:0):親愛) * 5
	LOCAL:100 -= (TALENT:(ARG:0):服従) * 2
	LOCAL:100 -= (TALENT:(ARG:0):隷属) * 5
	LOCAL:100 -= (TALENT:(ARG:0):恋人) * 2
	LOCAL:100 -= (TALENT:(ARG:0):烙印) * 2
	LOCAL:100 -= (TALENT:(ARG:0):合意) * 2
	LOCAL:100 -= (TALENT:(ARG:0):正妻) * 5
	LOCAL:100 -= (TALENT:(ARG:0):妾) * 5
ENDIF
RETURNF LOCAL:100

;type8 状態異常
@AUTO_N_TYPE8(ARG:0, ARG:1)
#FUNCTION
LOCAL:100 = 0
IF ARG:1 == 1
	LOCAL:100 += (TALENT:(ARG:0):崩壊) * 2
	LOCAL:100 += (TALENT:(ARG:0):虚ろ) * 2
	LOCAL:100 += GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_雌犬) * 2
	LOCAL:100 += GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_精液便女) * 2
	LOCAL:100 += (TALENT:(ARG:0):妊娠) * 2
	FOR LOCAL, 0, MAX_SP_COUNTRY
		LOCAL:100 += GETBIT(TALENT:(ARG:0):特殊勢力陥落系, LOCAL) * 2
	NEXT
	LOCAL:100 += GETBIT(TALENT:(ARG:0):デイリー系, 素質_デイリー_薬売りの性奴隷) * 2
	LOCAL:100 += GETBIT(TALENT:(ARG:0):デイリー系, 素質_デイリー_貴族の虜) * 2
ELSE
	LOCAL:100 = 32
	LOCAL:100 -= (TALENT:(ARG:0):崩壊) * 2
	LOCAL:100 -= (TALENT:(ARG:0):虚ろ) * 2
	LOCAL:100 -= GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_雌犬) * 2
	LOCAL:100 -= GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_精液便女) * 2
	LOCAL:100 -= (TALENT:(ARG:0):妊娠) * 2
	LOCAL:100 += GETBIT(TALENT:(ARG:0):特殊勢力陥落系, 特殊勢力_野盗) * 2
	LOCAL:100 += GETBIT(TALENT:(ARG:0):特殊勢力陥落系, 特殊勢力_ホフゴブリン) * 2
	LOCAL:100 += GETBIT(TALENT:(ARG:0):特殊勢力陥落系, 特殊勢力_外来人) * 2
	LOCAL:100 -= GETBIT(TALENT:(ARG:0):デイリー系, 素質_デイリー_薬売りの性奴隷) * 2
	LOCAL:100 -= GETBIT(TALENT:(ARG:0):デイリー系, 素質_デイリー_貴族の虜) * 2
ENDIF
RETURNF LOCAL:100
