;-------------------------------------------------
;同盟を破棄
;-------------------------------------------------
@DIPLOMACY_ALLIANCE_RENOUNCE(ARG:0)
LOCAL:5 = GET_COUNTRY_BOSS(ARG:0)
CALL CHECK_COUNTRY_RELATION(CFLAG:MASTER:所属, ARG:0)
LOCAL:3 = RESULT

IF LOCAL:3 != 3 && LOCAL:3 != 4
	PRINTFORMW 同盟破棄は、そもそも同盟している勢力にしか行えません
	RETURN 0
ENDIF

PRINTFORML %ANAME(LOCAL:5)%と結んでいる同盟を一方的に破棄します
PRINTFORML 相手からはものすごい反発を受けますし、他勢力からもいい顔はされないでしょう
PRINTFORML それでも同盟を破棄しますか？
CALL ASK_YN
IF RESULT == 0
	;削除対象となる同盟の検索
	FOR LOCAL, 0, MAX_TREATY_A
		IF TREATY_A_TERM:LOCAL > 0
			FOR LOCAL:1, 0, MAX_TREATY_COUNTRY
				IF TREATY_A_COUNTRY:LOCAL:(LOCAL:1) == CFLAG:MASTER:所属
					FOR LOCAL:2, 0, MAX_TREATY_COUNTRY
						IF TREATY_A_COUNTRY:LOCAL:(LOCAL:2) == ARG:0
							GOTO BREAK_LABEL
						ENDIF
					NEXT
				ENDIF
			NEXT
		ENDIF
	NEXT
	$BREAK_LABEL
	IF LOCAL != MAX_TREATY_A
		PRINTFORML %ANAME(LOCAL:5)%との同盟を破棄しました
		PRINTFORML この行いに、%ANAME(LOCAL:5)%は強い反発を覚えています
		PRINTFORMW また、他の勢力も、不信感を抱いたようです
		FOR LOCAL:1, 0, MAX_COUNTRY
			IF IS_COUNTRY(LOCAL:1) && LOCAL:1 != LOCAL:2
				CALL CHANGE_RELATION_C_TO_C(LOCAL:1, CFLAG:MASTER:所属, -300, 300)
				IF TREATY_A_TERM:LOCAL == 9999
					CALL CHANGE_RELATION_C_TO_C(LOCAL:1, CFLAG:MASTER:所属, -500, 500)
				ENDIF
			ELSEIF IS_COUNTRY(LOCAL:1) && LOCAL:1 == LOCAL:2
				CALL CHANGE_RELATION_C_TO_C(LOCAL:1, CFLAG:MASTER:所属, -800, 800)
				IF TREATY_A_TERM:LOCAL == 9999
					CALL CHANGE_RELATION_C_TO_C(LOCAL:1, CFLAG:MASTER:所属, -1000, 1000)
				ENDIF
			ENDIF
		NEXT
		CALL GO_TO_MASTERS_COUNTRY(TREATY_A_COUNTRY:LOCAL:(LOCAL:2))
		FOR LOCAL:1, 0, MAX_TREATY_COUNTRY
			TREATY_A_COUNTRY:LOCAL:(LOCAL:1) = 0
		NEXT
		TREATY_A_TERM:LOCAL = 0
	ELSE
		PRINTFORMW 同盟破棄を選択した途中でエラーだよ　ここにはこないはずだよ
		PRINTFORMW もしこのメッセージを見かけたら教えてね 喚くより
		RETURN 0
	ENDIF
ELSE
	;同盟破棄による外交印象の悪化
	DIPLOMACY_HATE:(CFLAG:MASTER:所属) += 3

	RETURN 0
ENDIF

